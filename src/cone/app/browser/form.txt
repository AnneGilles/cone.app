Forms
=====

``cone.app`` uses ``yafowil`` as form engine. See Documentation of
``yafowil`` for details how to use it.

Abstract form tile, which renders forms, does form processing and renders 
or redirects to a result. You have to provide the ``form`` property on a 
deriving object returning a yafowil widget tree::

    >>> from yafowil import loader
    >>> from yafowil.base import factory
    >>> from cone.tile import tile
    >>> from cone.app.browser.utils import make_url
    >>> from cone.app.browser.form import Form
    
    >>> @tile('subscriptionform')
    ... class SubscriptionForm(Form):
    ...     
    ...     def prepare(self):
    ...         form = factory(u'form',
    ...                        name='subscriptionform',
    ...                        props={'action': self.nodeurl})
    ...         form['email'] = factory(
    ...             'field:label:error:text',
    ...             props = {
    ...                 'required': 'No email given',
    ...                 'label': 'E-Mail',
    ...             })
    ...         form['subscribe'] = factory(
    ...             'submit',
    ...             props = {
    ...                 'action': 'subscribe',
    ...                 'expression': True,
    ...                 'handler': self.subscribe,
    ...                 'next': self.next,
    ...                 'label': 'Subscribe',
    ...             })
    ...         self.form = form
    ...     
    ...     def subscribe(self, widget, data):
    ...         """Do subscription here
    ...         """
    ...         print 'subscribe on "%s"' % self.model.__name__
    ...         
    ...     def next(self, request):
    ...         return '<div>Result</div>'

Create dummy model and request::

    >>> from cone.app.model import BaseNode
    >>> from pyramid.testing import DummyRequest
    >>> model = BaseNode()
    >>> model.__name__ = 'dummymodel'
    >>> request = DummyRequest()
    >>> layer.authenticate('max')

Render form. no action is triggered and no input is given::
    
    >>> from cone.tile import render_tile
    >>> rendered = render_tile(model, request, 'subscriptionform')
    >>> expected = 'action="http://example.com/dummymodel"'
    >>> rendered.find(expected) != -1
    True
    
    >>> expected = 'id="form-subscriptionform"'
    >>> rendered.find(expected) != -1
    True
    
    >>> expected = 'name="subscriptionform.email"'
    >>> rendered.find(expected) != -1
    True
    
    >>> expected = 'name="action.subscriptionform.subscribe"'
    >>> rendered.find(expected) != -1
    True
    
Trigger subscribe action and set empty email value. Results in a form with
error message since email is required::

    >>> request.params['action.subscriptionform.subscribe'] = '1'
    >>> request.params['subscriptionform.email'] = ''

    >>> rendered = render_tile(model, request, 'subscriptionform')
    >>> expected = 'No email given'
    >>> rendered.find(expected) != -1
    True

Trigger subscribe action and set valid email value. Now the action handler and
next handler are triggered::

    >>> request.params['subscriptionform.email'] = 'john.doe@example.com'
    
    >>> rendered = render_tile(model, request, 'subscriptionform')
    subscribe on "dummymodel"
    
    >>> rendered.find('Result') != -1
    True
    
    >>> layer.logout()
